## Problema

29 - O ficheiro [`029.tsv`](02/029.tsv) contém dados, separados por _tabs_,
sobre todos os exoplanetas conhecidos (a 30-11-2018). Cada linha contém a
seguinte informação:

* ID do planeta
* Nome do sistema estelar a que o planeta pertence
* Letra do planeta dentro do seu sistema estelar
* Nome do planeta
* Método de deteção do planeta
* Período orbital em dias
* Distância em _parsecs_
* Temperatura em Kelvins
* Telescópio responsável pela descoberta

As linhas que começam com o carácter `#` são comentários e devem ser ignoradas.

Cria um projeto no Visual Studio que respeite os seguintes requisitos:

1. Enumeração que contenha os diferentes métodos de descoberta de exoplanetas.
2. _Struct_ imutável `Planet`, que contém toda a informação sobre um planeta
   sob a forma de propriedades só de leitura e um construtor para inicializar
   essas mesmas propriedades. Cada propriedade deve ser do tipo apropriado ao
   dado que reporta.
3. A _struct_ `Planet` deve ter _overrides_ de `GetHashCode()` e `Equals()` de
   modo a que a igualdade entre planetas dependa apenas do respetivo ID.
4. Classe `PlanetLoader`, com um único método `LoadPlanets()`. Este método
   aceita um parâmetro o nome de ficheiro que contém os dados sobre os
   planetas, devolvendo um `IEnumerable<Planet>` com todos os planetas lidos.
   Tanto a classe como o método devem ser `static`.
5. Classe `Program`, com método `Main()`, no qual é invocado o método
   `LoadPlanets()`, e posteriormente mostrada no ecrã a seguinte informação,
   obtida com o uso de Lambdas e LINQ (sintaxe fluente ou expressões _query_,
   sem preferência):
   * Número de exoplanetas existentes.
   * Método mais comum de deteção.
   * Máximo de exoplanetas em torno da mesma estrela.
   * Média do período orbital.
   * Planeta mais longínquo (e a respetiva distância).
   * Média da temperatura dos planetas cuja estrela tem pelo menos dois
     planetas.
   * Telescópio com menos descobertas.
6. Todas as possíveis exceções devem ser tratadas ao nível da classe
   `Program`.
7. Todas as classes e respetivos membros devem estar documentados com
   comentários XML.

> [Soluções](../solucoes/02/029.md)

## Soluções

### Solução 1

`Class Program`

```cs

using System;
using System.Linq;
using System.Collections.Generic;

namespace Ex29
{
    public class Program
    {
        private static void Main(string[] args)
        {
            // All planets will be stored here
            List<Planet> planets;

            // Instantiate list with LoadPlanets giving the filename
            planets = new List<Planet>
                (PlanetLoader.LoadPlanets("029.txt"));

            // 1 - Number of existing Planets
            Console.WriteLine($"Number of existing Planets:" +
                $" {PCounter(planets)}");

            // 2 - Most common method of detection
            Console.WriteLine($"Most common method of detection: " +
                $"{MethodOfDetection(planets)}");

            // 3 - Maximum number of planets surrounding the same star
            Console.WriteLine($"The maximum number of planets surrounding " +
                $"the same star is: {PlanetsStar(planets)}");

            // 4 - Average orbital period
            Console.WriteLine($"Average orbital period is: " +
                $" {OrbitalPeriodAvg(planets)}");

            // 5 - Biggest Distance
            Console.WriteLine($"Furthest planet is: " +
                $"{BiggestDistance(planets).Name} and the distance is: " +
                $"{BiggestDistance(planets).DistancePC}");

            // 6 - Avg temperature dos planetas cuja estrela tem pelo menos dois planetas.
            Console.WriteLine($"Average temperature is {AvgTempRestr(planets)}");

            // 7 - Telescope with the least amount of discoveries
            Console.WriteLine($"Least common Telescope: " +
                $"{TelesWithLeastDisc(planets)}");
        }

        /// <summary>
        /// Counts all existing planets, accepts an IEnumerable<Planet>
        /// And returns the sum of all Planets
        /// </summary>
        private static readonly Func<IEnumerable<Planet>, int>
            PCounter = pcounter => pcounter.Count();

        /// <summary>
        /// Gets the most common method of detection
        /// </summary>
        /// <param name="planets">
        /// Accepts an IEnumerable<Planet>
        /// </param>
        /// <returns> 
        /// Returns a string with the most common method of detection
        /// </returns>
        private static string MethodOfDetection(IEnumerable<Planet> planets)
        {
            string methodOfDetection;
            List<string> methodsOfDetection = new List<string>();

            // Adds the methods of detection to the list<string>
            foreach (Planet p in planets)
            {
                methodsOfDetection.Add(p.DiscoMethod);
            }

            // Assigns most common method of detection
            methodOfDetection = methodsOfDetection.GroupBy(i => i)
                .OrderByDescending(n => n.Count())
                .Select(n => n.Key)
                .FirstOrDefault();

            return methodOfDetection;
        }

        /// <summary>
        /// Gets the Maximum number of planets surrounding the same star
        /// - could be optimized
        /// </summary>
        /// <param name="planets"></param>
        /// <returns> Returns an int, the desired number </returns>
        private static int PlanetsStar(IEnumerable<Planet> planets)
        {
            int planetsStar = 0;
            string mostCommonHost;

            List<string> starSystems = new List<string>();

            // Adds the host names/star systems to the list<string>
            foreach (Planet p in planets)
            {
                starSystems.Add(p.HostName);
            }

            // Assigns most common host/star system
            mostCommonHost = starSystems.GroupBy(i => i)
                .OrderByDescending(n => n.Count())
                .Select(n => n.Key)
                .FirstOrDefault();

            // Counts number of planets that surround the most common star
            foreach (Planet p in planets)
            {
                if (p.HostName == mostCommonHost)
                {
                    planetsStar++;
                }
            }
            return planetsStar;
        }

        /// <summary>
        ///  Makes average of all planets Orbital Period
        /// </summary>
        /// <param name="planets"> Accepst an IEnumerable of Planets</param>
        /// <returns> Returns average float </returns>
        private static float OrbitalPeriodAvg(IEnumerable<Planet> planets)
        {
            float oPavg = 0;

            foreach (Planet p in planets)
            {
                oPavg += p.OrbitalPeriod;
            }
            oPavg /= planets.Count();

            return oPavg;
        }

        /// <summary>
        /// Gets biggest distance of the planet in the Collection
        /// </summary>
        /// <param name="planets"> Accepts an IEnumerable of planets </param>
        /// <returns> Returns the Planet with biggest distance </returns>
        private static Planet BiggestDistance(IEnumerable<Planet> planets)
        {
            Planet newPlanet = new Planet();
            float biggestDistance = default;

            foreach (Planet p in planets)
            {
                if (biggestDistance < p.DistancePC)
                {
                    // Assign biggest distance
                    biggestDistance = p.DistancePC;
                    newPlanet = p;
                }
            }
            return newPlanet;
        }

        /// <summary>
        /// Get the average planet temperature that
        /// the host has at least 2 planets
        /// </summary>
        /// <param name="planets"> Accepts an IEnumerable of planets </param>
        /// <returns> Returns temperature float </returns>
        private static float AvgTempRestr(IEnumerable<Planet> planets)
        {
            float temperature = default;
            int count = 1;
            int i = 0;
            List<string> duplicates;
            List<string> hosts = new List<string>();

            // Percorrer lista
            foreach (Planet p in planets)
            {
                // Add repited hosts to list
                hosts.Add(p.HostName);
            }

            // Create list of duplicates' hosts'
            duplicates = hosts.GroupBy(x => x)
                             .Where(g => g.Count() > count)
                             .Select(g => g.Key)
                             .ToList();
 
            // For each planet add it's temperature to var
            foreach (Planet p in planets)
            {
                if (duplicates.Contains(p.HostName))
                {
                    temperature += p.TemperatureK;
                    i++;
                }
            }

            // Average of temperatures
            temperature /= i;// duplicates.Count();

            return temperature;
        }

        /// <summary>
        /// Get the name of the telescope with the least discoveries
        /// </summary>
        /// <param name="planets"> Accepts an IEnumerable of planets </param>
        /// <returns> Returns the name, string </returns>
        private static string TelesWithLeastDisc(IEnumerable<Planet> planets)
        {
            string lonelytelescope;
            List<string> telescopes = new List<string>();

            // Adds the methods of detection to the list<string>
            foreach (Planet p in planets)
            {
                telescopes.Add(p.Telescope);
            }

            // Assigns least common telescope
            lonelytelescope = telescopes.GroupBy(i => i)
                .OrderByDescending(n => n.Count())
                .Select(n => n.Key)
                .LastOrDefault();

            return lonelytelescope;
        }
    }
}
```

`Class PlanetLoader`

```cs

using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

namespace Ex29
{
    /// <summary>
    /// Class with method that sorts file
    /// Into IEnumerable of Planet
    /// </summary>
    public static class PlanetLoader
    {
        /// <summary>
        /// Converts a file and instantiates planets
        /// To return in an IEnumerable
        /// </summary>
        /// <param name="filename">
        /// Acepts a filename to convert
        /// To an IEnumerable of planet
        /// </param>
        /// <returns> Returns an IEnumerable of planets </returns>
        public static IEnumerable<Planet> LoadPlanets(string filename)
        {
            // Planet params
            int id = default;
            float orbitPeriod = default;
            float distance = default;
            float tempK = default;
            string name = default;
            string telescope = default;
            string discoMethod = default;
            string hostName = default;
            char pLetter = default;

            // To be converted to planet params
            string idString;

            // Line
            string line;
            string[] splitLine;
            char[] tempLetterArr;

            // List of Planet
            List<Planet> list = new List<Planet>();

            StreamReader file = new StreamReader(filename);

            // Reads each line of file, that doesn't start with '#'
            while ((line = file.ReadLine()) != null)
            {
                // Split lines in tabs
                splitLine = line.Split('\t').ToArray();

                if (line[0] != '#' && line[0] != 'l')
                {
                    // Get planet ID
                    idString = new string
                        (line.TakeWhile(char.IsDigit).ToArray());
                    id = Convert.ToInt32(idString);

                    // Get planet HostName
                    hostName = splitLine[1];

                    // Get Planet letter
                    tempLetterArr = splitLine[2].ToCharArray();
                    pLetter = tempLetterArr[0];

                    // Get Planet Name
                    name = splitLine[3];

                    // Get Planet Discovery method
                    discoMethod = splitLine[4];

                    // Get Planet Orbital Period
                    orbitPeriod = float.TryParse(splitLine[5], out orbitPeriod)
                        ? orbitPeriod = float.Parse(splitLine[5])
                        : default;

                    // Get Planet Distance
                    distance = float.TryParse(splitLine[6], out distance)
                        ? distance = float.Parse(splitLine[6])
                        : default;

                    // Get Planet Temperature                
                    tempK = float.TryParse(splitLine[7], out tempK)
                        ? tempK = float.Parse(splitLine[7])
                        : default;                  

                    // Get Planet telescope (discovery facility)
                    telescope = splitLine[8];

                    // Instatiate planet
                    Planet planet = new Planet(id, orbitPeriod,
                        distance, tempK, name, telescope,
                        discoMethod, hostName, pLetter);

                    list.Add(planet);
                }
            }

            file.Close();

            // Returns the list
            return list;
        }
    }
}
```

`Class Planet`

```cs

using System;

namespace Ex29
{
    /// <summary>
    /// Planet struct with readonly properties,
    /// Constructor and overrides to Equals and
    /// GetHashCode
    /// </summary>
    public struct Planet
    {
        /// <summary>
        /// ID of planet, int
        /// </summary>
        public int ID { get; }

        /// <summary>
        /// Planet's Orbital Period, int
        /// </summary>
        public float OrbitalPeriod { get; }

        /// <summary>
        /// Distance in Parsecs, int
        /// </summary>
        public float DistancePC { get; }

        /// <summary>
        /// Temperature in kelvins, int
        /// </summary>
        public float TemperatureK { get; }

        /// <summary>
        /// Planet's name, string
        /// </summary>
        public string Name { get; }

        /// <summary>
        /// Telescope that discovered the planet, string
        /// </summary>
        public string Telescope { get; }

        /// <summary>
        /// Planet's discovery method, string
        /// </summary>
        public string DiscoMethod { get; }

        /// <summary>
        /// Host name is name the name of the
        /// Star system the planet is in, string
        /// </summary>
        public string HostName { get; }

        /// <summary>
        /// Planet's letter, string
        /// </summary>
        public char PlanetLetter { get; }

        // Constructor
        /// <summary>
        /// Accepts the planet's ID, Orbit period, Distance in parsecs
        /// Temperature in Kelvins, Name, the Telescope, discovery method, 
        /// Solar System and it's char in it's solar system
        /// </summary>
        /// <param name="id"></param>
        /// <param name="orbitPeriod"></param>
        /// <param name="distance"></param>
        /// <param name="tempK"></param>
        /// <param name="name"></param>
        /// <param name="telescope"></param>
        /// <param name="discoMethod"></param>
        /// <param name="hostName"></param>
        /// <param name="pLetter"></param>
        public Planet(int id, float orbitPeriod,
            float distance, float tempK,
            string name, string telescope,
            string discoMethod,
            string hostName, char pLetter)
        {
            // Assign properties
            ID = id;
            OrbitalPeriod = orbitPeriod;
            DistancePC = distance;
            TemperatureK = tempK;
            Name = name;
            Telescope = telescope;
            DiscoMethod = discoMethod;
            HostName = hostName;
            PlanetLetter = pLetter;
        }

        /// <summary>
        /// Equals override
        /// </summary>
        /// <param name="obj"> Accepts an obj which
        /// is a planet</param>
        /// <returns> Returns a bool, planet == other</returns>
        public override bool Equals(object obj) => obj is Planet planet &&
                   ID == planet.ID;

        /// <summary>
        /// Gets ID of a planet
        /// </summary>
        /// <returns></returns>
        public override int GetHashCode()
        {
            return HashCode.Combine(ID);
        }
    }
}
```

*Por [João Rebelo](https://github.com/JBernardoRebelo)*