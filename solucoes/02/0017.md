## Problema

17 - Usando as interfaces nativas do C# para implementação do 
_Observer pattern_, nomeadamente `IObserver<T>` e `IObservable<T>`, implementa:

1. Um sujeito/observável que leia teclas do teclado (suprimindo a tecla lida
de modo a que não apareça no ecrã) e notifique os observadores cada vez 
que uma tecla é premida.
2. Um observador que indique no ecrã a tecla lida (e.g. `Detetada tecla 'R'`).
3. Um observador que guarde o carácter associado à tecla 
num ficheiro (em modo `append`).

O programa deve terminar quando for pressionada a tecla _Escape_.

## Soluções

### Solução 1

Class Program:

```cs
namespace Ex17
{
    public class Program
    {
        private static void Main(string[] args)
        {
            Subject subject = new Subject();
            ObserverGen obsScreen = new ObserverScreen();
            ObserverGen obsFile = new ObserverFile("ProgramOutput");

            // Add observers to collection
            subject.registerObserver(obsScreen);
            subject.registerObserver(obsFile);

            // Start loop
            subject.Execute();
        }
    }
}
```

Class Subject:

```cs
using System;
using System.Collections.Generic;

namespace Ex17
{
    public class Subject : IObservable<ObserverGen>
    {
        public ConsoleKey LastKey { get; private set; }
        private ICollection<ObserverGen> observers;

        // Subject constructor, initializes list of IObserver
        public Subject()
        {
            observers = new List<ObserverGen>();
        }

        // Add an observer to the observer collection
        public void registerObserver(ObserverGen observer)
        {
            observers.Add(observer);
        }

        // Removes and observer from the oberver collection
        public void removeObserver(ObserverGen observer)
        {
            observers.Remove(observer);
        }

        public void Execute()
        {
            // Every time a key is pressed...
            while (true)
            {
                // Get key while it isn't 'escape'
                LastKey = Console.ReadKey(true).Key;

                // Out of loop when 'escape' is pressed
                if (LastKey == ConsoleKey.Escape) break;

                // ...informs all observers in collection
                foreach (ObserverGen o in observers)
                {
                    o.OnNext(this);
                }
            }
        }

        public IDisposable Subscribe(IObserver<ObserverGen> observer)
        {
            throw new NotImplementedException();
        }
    }
}
```

Class ObserverScreen:

```cs
using System;

namespace Ex17
{
    public class ObserverScreen : ObserverGen
    {
        public override void OnNext(Subject subject)
        {
            // Outputs to screen the pressed key
            Console.WriteLine("Detetada a tecla: '"+ subject.LastKey+ "'");
        }
    }
}
```

Class ObserverFile:

```cs
using System.IO;

namespace Ex17
{
    public class ObserverFile : ObserverGen
    {
        private string filename;

        // Constructor, accepts a string
        // that corresponds to the file name created
        public ObserverFile(string filename)
        {
            this.filename = filename;
        }

        public override void OnNext(Subject subject)
        {
            // Writes info (input) in a file
            File.AppendAllText(filename, subject.LastKey.ToString());
        }
    }
}
```

Class ObserverGen:

```cs
using System;

namespace Ex17
{
    public abstract class ObserverGen : IObserver<Subject>
    {
        // Outputs message when program ends
        public void OnCompleted()
        {
            Console.WriteLine("Task completed");
        }

        // Outputs error message
        public void OnError(Exception error)
        {
            Console.WriteLine(error);
        }

        // To be overridden by classes that inherit this
        public abstract void OnNext(Subject value);
    }
}
```

*Por [João Rebelo](https://github.com/JBernardoRebelo)*
